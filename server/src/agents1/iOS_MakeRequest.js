ðŸ“¦
4926 /agent/index.js.map
3575 /agent/index.js
âœ„
{"version":3,"file":"index.js","names":["requestHandler","constructor","this","jsonPayload","ObjC","available","NSURL","classes","NSURLRequest","NSURLSession","NSDictionary","NSMutableDictionary","NSString","NSMutableURLRequest","configuration","NSURLSessionConfiguration","setupCompletionHandler","console","error","completionHandler","Block","retType","argTypes","implementation","data","response","isNull","responseObj","Object","isKindOfClass_","NSHTTPURLResponse","httpResponse","url","URL","absoluteString","toString","headers","allHeaderFields","statusCode","urlHost","split","urlEndpoint","slice","join","headersList","keys","allKeys","i","count","key","objectAtIndex_","value","objectForKey_","push","dataObj","jsonString","alloc","initWithData_encoding_","send","JSON","stringify","makeGETRequest","requestUrl","requestHeaders","defaultSessionConfiguration","session","sessionWithConfiguration_delegate_delegateQueue_","urlString","stringWithString_","URLWithString_","request","requestWithURL_","headersDict","init","setValue_forKey_","setAllHTTPHeaderFields_","tmpHeaders","allHTTPHeaderFields","dataTaskWithRequest_completionHandler_","resume","makePOSTRequest","requestBody","setHTTPMethod_","bodyData","dataUsingEncoding_","setHTTPBody_","recv","onMessageReceived","message","type","payload","method","parse","request_headers","tmpHeader","trim","host","endpoint","request_body","wait","log"],"sourceRoot":"/tmp/agents/iOS_MakeRequest/agent/","sources":["index.ts"],"mappings":"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"}
âœ„
const t=new class{constructor(){this.jsonPayload={},ObjC.available?(this.NSURL=ObjC.classes.NSURL,this.NSURLRequest=ObjC.classes.NSURLRequest,this.NSURLSession=ObjC.classes.NSURLSession,this.NSDictionary=ObjC.classes.NSDictionary,this.NSMutableDictionary=ObjC.classes.NSMutableDictionary,this.NSString=ObjC.classes.NSString,this.NSMutableURLRequest=ObjC.classes.NSMutableURLRequest,this.configuration=ObjC.classes.NSURLSessionConfiguration,this.setupCompletionHandler()):console.error("Objective-C runtime not available.")}setupCompletionHandler(){this.completionHandler=new ObjC.Block({retType:"void",argTypes:["pointer","pointer","pointer"],implementation:(t,s,e)=>{if(t.isNull())console.error("Error: "+e);else{const e=new ObjC.Object(s);if(e.isKindOfClass_(ObjC.classes.NSHTTPURLResponse)){const t=e,s=t.URL().absoluteString().toString(),i=t.allHeaderFields(),o=t.statusCode(),n=s.split("/")[2],a="/"+s.split("/").slice(3).join("/"),l=[];if(i){const t=i.allKeys();for(let s=0;s<t.count();s++){const e=t.objectAtIndex_(s).toString(),o=i.objectForKey_(e).toString();l.push(`${e}: ${o}`)}}this.jsonPayload.host=n,this.jsonPayload.endpoint=a,this.jsonPayload.status_code=o,this.jsonPayload.response_headers=l}const i=new ObjC.Object(t),o=this.NSString.alloc().initWithData_encoding_(i,4);this.jsonPayload.response_body=o.toString(),send(JSON.stringify(this.jsonPayload))}}})}makeGETRequest(t,s){const e=this.configuration.defaultSessionConfiguration(),i=this.NSURLSession.sessionWithConfiguration_delegate_delegateQueue_(e,null,null),o=this.NSString.stringWithString_(t),n=this.NSURL.URLWithString_(o),a=this.NSMutableURLRequest.requestWithURL_(n),l=this.NSMutableDictionary.alloc().init();for(const t in s){const e=s[t];l.setValue_forKey_(this.NSString.stringWithString_(e),this.NSString.stringWithString_(t))}a.setAllHTTPHeaderFields_(l);const r=[],h=a.allHTTPHeaderFields(),d=h.allKeys();for(let t=0;t<d.count();t++){const s=d.objectAtIndex_(t).toString(),e=h.objectForKey_(s).toString();r.push(`${s}: ${e}`)}this.jsonPayload.request_headers=r,this.jsonPayload.method="GET";i.dataTaskWithRequest_completionHandler_(a,this.completionHandler).resume()}makePOSTRequest(t,s,e){this.jsonPayload.request_body=e;const i=this.configuration.defaultSessionConfiguration(),o=this.NSURLSession.sessionWithConfiguration_delegate_delegateQueue_(i,null,null),n=this.NSString.stringWithString_(t),a=this.NSURL.URLWithString_(n),l=this.NSMutableURLRequest.requestWithURL_(a),r=this.NSMutableDictionary.alloc().init();for(const t in s){const e=s[t];r.setValue_forKey_(this.NSString.stringWithString_(e),this.NSString.stringWithString_(t))}l.setAllHTTPHeaderFields_(r);const h=[],d=l.allHTTPHeaderFields(),S=d.allKeys();for(let t=0;t<S.count();t++){const s=S.objectAtIndex_(t).toString(),e=d.objectForKey_(s).toString();h.push(`${s}: ${e}`)}this.jsonPayload.request_headers=h,l.setHTTPMethod_("POST"),this.jsonPayload.method="POST";const c=this.NSString.stringWithString_(e).dataUsingEncoding_(4);l.setHTTPBody_(c);o.dataTaskWithRequest_completionHandler_(l,this.completionHandler).resume()}};recv((function s(e){if("data"===e.type)if("GET"===e.payload.method){var i={};const s=JSON.parse(e.payload.request_headers);for(var o in s){const t=s[o].split(":");i[t[0].trim()]=t[1].trim()}t.makeGETRequest("http:"+e.payload.host+e.payload.endpoint,i)}else{i={};const s=JSON.parse(e.payload.request_headers);for(var o in s){const t=s[o].split(":");i[t[0].trim()]=t[1].trim()}t.makePOSTRequest("http:"+e.payload.host+e.payload.endpoint,i,e.payload.request_body)}recv(s).wait()})),console.log("End");